<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>index.html</title>
	<base href="./ "/>
</head>
<body>
	<div></div>
	<script src="rex-core.js"></script>
	<script src="rex-es.js"></script>
	
	<script>
		new function(){
			var debug = true;
			
			// 初始化解析器包
			var xhr = new XMLHttpRequest();
			
			var filename = document.baseURI + (debug ? "index.js" : "test-old/profile.js");
			
			window.b = 123;
			
			xhr.onreadystatechange = function(){
				if(
					this.status === 200 && this.readyState === 4
				){
					var parser = new Rexjs.SyntaxParser(
						new Rexjs.ECMAScriptTagsMap(),
						new Rexjs.ECMAScriptStatements()
					);
					
					var file = new Rexjs.File(filename, xhr.responseText);
					
					if(
						debug
					){
						var builder = new Rexjs.MappingBuilder(file);
						
						parser.parse(file);
						
						var result = parser.build(builder);
						
						eval(result);
						
						document.querySelector("body > div").innerHTML = result;
						return;
					}
					
					var builder = new Rexjs.ContentBuilder();
					
					console.time("ss")
					parser.parse(file);
					
					var result = parser.build(builder);
					console.timeEnd("ss")
					
					new Function(result)
				}
			};
			
			
			xhr.open("get", filename);
			xhr.send();
		}()
	</script>
</body>
</html>
